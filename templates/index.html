<!DOCTYPE html>
<html>
<head>
    <title>qPCR Primer Designer with BLAST</title>
    <script>
        async function pollResult(jobId, label) {
            const res = await fetch("/blast_result/" + jobId);
            const data = await res.json();
            const el = document.getElementById(label + "-status");
            if (data.ready) {
                el.textContent = "âœ… " + data.result;
            } else {
                el.textContent = "ðŸ”„ Pending...";
                setTimeout(() => pollResult(jobId, label), 3000);
            }
        }
    </script>
</head>
<body>
    <h2>ðŸ”¬ qPCR Primer + Probe Designer with BLAST</h2>
    <form method="post">
        <label for="name">Enter Gene or Pathogen Name:</label><br>
        <input type="text" id="name" name="name" size="60" required>
        <button type="submit">Design Primers</button>
    </form>

    {% if error %}
        <p style="color:red;">{{ error }}</p>
    {% endif %}

    {% if result %}
    <h3>ðŸ§¬ Designed Primers for: {{ name }}</h3>
    <ul>
        {% for label, info in result.primers.items() %}
        <li>
            <strong>{{ label }}:</strong> {{ info.seq }}<br>
            <span id="{{ label }}-status">ðŸ”„ Checking specificity...</span>
            <script>pollResult("{{ info.job_id }}", "{{ label }}")</script>
        </li>
        {% endfor %}
    </ul>
    {% endif %}
</body>
</html>
